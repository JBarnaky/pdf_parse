# PDF Validator and Barcode Extractor

## Описание
Этот скрипт предназначен для проверки соответствия структуры данных в PDF-файле заданному шаблону, а также для извлечения штрих-кодов с страниц PDF. Он использует многопоточность для повышения производительности при работе с большими файлами.

---

## Зависимости
Установите следующие библиотеки:
```bash
pip install pymupdf pyzbar Pillow python-dateutil
```

---

## Как запустить
```bash
python script.py [шаблон.pdf] [тестовый.pdf] [опции]
```

### Параметры:
- `шаблон.pdf` (опционально, по умолчанию: `test_task.pdf`): Путь к PDF-файлу с шаблоном структуры.
- `тестовый.pdf` (опционально, по умолчанию: `test_task.pdf`): Путь к PDF-файлу для проверки.
- `-threads` (или `--threads`): Максимальное количество потоков (по умолчанию: `min(8, os.cpu_count() or 2)`).
- `--dpi` (или `-dpi`): Разрешение (DPI) для изображения при распознавании штрих-кодов (по умолчанию: `200`).

---

## Примеры использования
1. **Базовый запуск с дефолтными путями:**
   ```bash
   python script.py
   ```
2. **С указанием пользовательских путей и параметров:**
   ```bash
   python script.py template.pdf test.pdf -threads 4 --dpi 300
   ```

---

## Вывод
Скрипт использует логирование для вывода информации:
- **Структура шаблона** и **тестовых данных** (в виде словарей).
- **Соответствие структуры** (или сообщения об ошибках: отсутствующие/лишние ключи).
- **Найденные штрих-коды** (если есть).

Пример лога:
```
2024-01-01 12:00:00 [INFO] Шаблон: {'NAME': 'Sample', 'EXP DATE': '01.01.2030'}
2024-01-01 12:00:00 [INFO] Структура соответствует шаблону
2024-01-01 12:00:00 [INFO] Найденные баркоды: ['123456', '789012']
```

---

## Ограничения
- **Форматирование текста в PDF:** Скрипт предполагает, что ключи в тексте PDF разделены двоеточием (`:`) и выровнены по строкам.
- **Штрих-коды:** Точность распознавания зависит от качества изображения в PDF.
- **Дата в поле `EXP DATE`:** Дата должна быть в формате `DD.MM.YYYY` и не должна превышать текущую дату на 10 лет.

---

## Как работает парсинг текста
1. Текст из каждой страницы PDF объединяется в один блок.
2. Каждая строка разбивается на ключ-значение по символу `:`.
3. Если ключ повторяется, значения объединяются в одну строку через пробел.

Пример:
```
NAME: John Doe
EXP DATE: 01.01.2030
```
Преобразуется в:
```python
{'NAME': 'John Doe', 'EXP DATE': '01.01.2030'}
```

---

## Дополнительная информация
- **Логирование:** Информация сохраняется в консоль в формате `YYYY-MM-DD HH:MM:SS [Уровень] Сообщение`.
- **Многопоточность:** Используется для ускорения обработки текста и изображений.
- **Штрих-коды:** Распознаются с помощью библиотеки `pyzbar` из растровых представлений страниц.
